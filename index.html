<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>DishMusic</title>
	<!-- <base href="/DeSpoiler/"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<!-- <link rel="icon" type="image/x-icon" href="favicon.ico"> -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script>
		$(async () => {
			let $list = $("#list");
			let $audio = $("audio");
			let playlists = await new Promise(resolve => { $.getJSON("/playlists", data => resolve(data)); });
			let currPlaylistIndex = undefined;
			let currSongIndex = undefined;

			function playNext() {
				if(currPlaylistIndex !== undefined) {
					if(currSongIndex === undefined) {
						currSongIndex = -1;
					}
					currSongIndex++;
					$audio.attr("src", `/playlists/${currPlaylistIndex}/file/${currSongIndex}`);
					$audio[0].play();
				}
			}

			$audio.on("ended", () => playNext());

			for (let i = 0; i < playlists.length; i++) {
				let playlist = playlists[i];
				let displayName = playlist.replace("/", "\\").replace("E:\\dokumentumok\\Zene", "")
				let currId = `playlist_${i}`;
				$list.append(`<div id=${currId}><button>${displayName}</button></div>`)
				$(`#${currId} > button`).click(() => {
					currSongIndex = undefined;
					currPlaylistIndex = i;
					playNext();
				});
			}
		});
	</script>
	<style>
		button {
			text-align: left;
		}
	</style>
</head>

<body>
	<audio autoplay controls src="https://interactive-examples.mdn.mozilla.net/media/cc0-audio/t-rex-roar.mp3"></audio>
	<div id="list"></div>
</body>

</html>